<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<title>Radio Record Player ver. 1.104s</title>
		<link rel="stylesheet" href="style.css"/>
		<script src="js/jquery-3.7.1.min.js"></script>
		<script src="js/jquery-ui.min.js"></script>
		<script src="js/jquery.animateSprite.min.js"></script>
		<script src="js/jquery.mousewheel.js"></script>
		<script src="js/stations.js"></script>
		<script src="js/soundmanager2.js"></script>
	</head>
	<body>
		<div class="radio">
			<div class="station" id="rr"><div class="station-img"><div class="cover"></div></div><div class="station-name"></div><div class="play disabled"><div class="play-button"></div><div class="play-button-bg"></div></div><div class="station-text"><span class="station-track-artist"></span><span class="station-track-title"></span></div><div class="volume"><div class="volume-click"></div><div class="volume-rollover"></div></div><div class="listen-player"><div class="listen-player-button"></div><div class="listen-player-selector"><a href="medialinks/listen_rr.m3u"></a><a href="medialinks/listen_rr.ram"></a><a href="medialinks/listen_rr.asx"></a></div></div><div class="pie-timer"><div class="pie-spinner"></div></div></div>
			<div class="station" id="ps"><div class="station-img"><div class="cover"></div></div><div class="station-name"></div><div class="play disabled"><div class="play-button"></div><div class="play-button-bg"></div></div><div class="station-text"><span class="station-track-artist"></span><span class="station-track-title"></span></div><div class="volume"><div class="volume-click"></div><div class="volume-rollover"></div></div><div class="listen-player"><div class="listen-player-button"></div><div class="listen-player-selector"><a href="medialinks/listen_ps.m3u"></a><a href="medialinks/listen_ps.ram"></a><a href="medialinks/listen_ps.asx"></a></div></div><div class="pie-timer"><div class="pie-spinner"></div></div></div>
			<div class="station" id="tm"><div class="station-img"><div class="cover"></div></div><div class="station-name"></div><div class="play disabled"><div class="play-button"></div><div class="play-button-bg"></div></div><div class="station-text"><span class="station-track-artist"></span><span class="station-track-title"></span></div><div class="volume"><div class="volume-click"></div><div class="volume-rollover"></div></div><div class="listen-player"><div class="listen-player-button"></div><div class="listen-player-selector"><a href="medialinks/listen_tm.m3u"></a><a href="medialinks/listen_tm.ram"></a><a href="medialinks/listen_tm.asx"></a></div></div><div class="pie-timer"><div class="pie-spinner"></div></div></div>
			<div class="station" id="teo"><div class="station-img"><div class="cover"></div></div><div class="station-name"></div><div class="play disabled"><div class="play-button"></div><div class="play-button-bg"></div></div><div class="station-text"><span class="station-track-artist"></span><span class="station-track-title"></span></div><div class="volume"><div class="volume-click"></div><div class="volume-rollover"></div></div><div class="listen-player"><div class="listen-player-button"></div><div class="listen-player-selector"><a href="medialinks/listen_teo.m3u"></a><a href="medialinks/listen_teo.ram"></a><a href="medialinks/listen_teo.asx"></a></div></div><div class="pie-timer"><div class="pie-spinner"></div></div></div>
		</div>
		<div class="footer">
			<div class="watch">
				<div class="playing-time"></div>
			</div>
			<div class="link">
				<a href="https://www.radiorecord.ru" target="_blank">www.radiorecord.ru</a>
				<div class="link-bg-blur"></div>
			</div>
		</div>
		<div class="tooltip"></div>
		<div class="context-menu">
			<ul>
				<li>
					<a href="https://www.radiorecord.ru" target="_blank">Radio Record</a>
				</li>
				<li>
					<a href="https://piratestation.info" target="_blank">Pirate Station</a>
				</li>
				<li class="menu-separator"></li>
				<li>
					<a href="https://rimfoer.github.io/Radio-Record-Player-ver.-1.104s/" name="Radio Record Player ver. 1.104s">Открыть в другом окне</a>
				</li>
				<li>
					<a href="https://rimfoer.github.io/Radio-Record-Player-ver.-1.205/" name="Radio Record Player ver. 1.205">Перейти на новую версию</a>
				</li>
			</ul>
		</div>
		<script>
			let ctInterval, mInterval, radio, url;
			let currParser = 0, currTime = 0, getCurVolPos = 0, playStatus = 'reading', smVolume = localStorage.currVolume || 70, smErrorCounter = 0;

			$(function() {
				if(Number(window.innerWidth) === 422) showMessage('closeTab');
				document.oncontextmenu = function() {return false;};
				localStorage.playSource = '';
			});

			soundManager.setup({
				preferFlash: false,
				onready: function() {
					checkLSItems();
					playStatus = 'stopped';
					$('.station').children('.play').removeClass('disabled');
					$('.volume-click, .volume-rollover').animateSprite(animParams);
					$('.volume-click').animateSprite('play', `${Math.round(smVolume/10)}`);
					updateTitle(0);
				},
				useHighPerformance: false
			});

			soundManager.onerror = function() {
				smErrorCounter++;
				if(smErrorCounter<10) setTimeout(() => soundManager.reboot(), 3000);
			};

			$(document).on('click', '.play-button', function() {
				if($(this).hasClass('playing') && playStatus === 'playing') {
					$(this).stop();
				} else if($(this).closest('.station').hasClass('active') && playStatus === 'stopped') {
					$(this).startPlay(url);
				} else if($(this).hasClass('playing') && playStatus === 'ended') {
					$(this).stop();
					setTimeout($(this).startPlay(url), 1000);
				} else {
					if(soundManager.soundIDs.length>0) $(this).stop();
					$('.station, .volume').removeClass('active');
					/*******************************************/
					$(this).closest('.station').addClass('active');
					radio = $(this).closest('.station').attr('id');
					url = stream[$(this).closest('.station').index()];
					$(this).startPlay(url);
				}
			});

			$(document).on('mousemove mousedown', '.volume.active', function(e) {
				let xpos = e.offsetX === undefined ? e.pageX-$(this).offset().left : e.offsetX;
				let	VolXMouse = Number(Math.round(xpos/25*10)*10).limiter();
				if(e.buttons === 1) { // лкм
					$('.volume-click').animateSprite('frame', Math.round(VolXMouse/10));
					smVolume = VolXMouse;
					soundManager.setVolume('record', VolXMouse);
					localStorage.currVolume = VolXMouse;
					if(soundManager.muted) soundManager.unmute();
				}
				$(this).children('.volume-rollover').animateSprite(getCurVolPos===0 ? 'play' : 'frame', `${Math.round(VolXMouse/10)}`);
				setTimeout(() => getCurVolPos = Math.round(VolXMouse/10), 300);
				showMessage('volume', VolXMouse);
			}).on('mouseleave', '.volume.active', function() {
				$(this).children('.volume-rollover').animateSprite('play', `r${getCurVolPos}`);
				setTimeout(() => getCurVolPos = 0, 300);
				showMessage();
			});

			$(document).on('mouseenter mouseover', '.listen-player-button', function() {
				$(this).closest('.listen-player').children('.listen-player-selector').addClass('active');
			}).on('click', '.listen-player-selector a', function() {
				if($(this).closest('.station').hasClass('active') && playStatus === 'playing') {
					$(`#${radio}`).stop();
					showMessage('nowplaying');
				}
				$('.listen-player-selector').removeClass('active');
				return $(this).attr('href');
			}).on('mouseleave', '.listen-player', function() {
				$('.listen-player-selector').removeClass('active');
			});

			$('.link a').on('click', function(e) {
				e.preventDefault();
				window.open(this.href, '_blank').focus();
			});

			$(document).on('dblclick', '.station-text', function() {
				if(showTitles.includes($(this).children('span:eq(1)').attr('title'))) {
					showMessage('nocopy');
				} else if($(this).children('span:eq(0)').attr('title') === '') {
					showMessage('nocopy');
				} else {
					navigator.clipboard.writeText($(this).children('span:eq(0)').attr('title') + ' - ' + $(this).children('span:eq(1)').attr('title'));
					showMessage('copy');
				}
			}).on('mouseenter', '.station-text span', function() {
				if(localStorage.copyTextTip === 'false') {
					$(this).css('pointer-events', 'none');
					showMessage('copytext');
					setTimeout(() => $(this).css('pointer-events', ''), 6000);
					localStorage.copyTextTip = 'true';
				}
			});

			$(document).on('click', function() {
				$('.context-menu').removeClass('active');
			}).on('contextmenu', function(e) {
				e.preventDefault();
				$('.context-menu').removeClass('active');
				$('.context-menu').css({left: `${e.pageX}px`, top: `${e.pageY}px`});
				$('.context-menu').addClass('active');
			}).on('click', '.context-menu ul li a', function(e) {
				e.preventDefault();
				$('.context-menu').removeClass('active');
				if(!$(this).attr('target')) {
					openURL(this.name, this.href);
				} else {
					window.open(this.href, '_blank').focus();
				}
			}).on('mouseleave', function() {
				$('.context-menu').removeClass('active');
			});

			$('body').on('mousemove', function(e) {
				$('.tooltip').css({left: `${e.pageX+18}px`, top: `${e.pageY-2}px`});
			});

			$(document).mousewheel(function(event, delta) {
				event.preventDefault();
				if(playStatus === 'playing' || playStatus === 'connecting') {
					if(delta>0) {
						smVolume = Math.round(smVolume-5).limiter();
					} else if(delta<0) {
						smVolume = Math.round(smVolume+5).limiter();
					}
					$('.volume-click').animateSprite('frame', Math.round(smVolume/10));
					soundManager.setVolume('record', smVolume);
					showMessage('volume');
					localStorage.currVolume = smVolume;
					if(soundManager.muted) soundManager.unmute();
				} else if(!$('.station').hasClass('active')) {
					showMessage('noselect');
				} else {
					showMessage('notplaying');
				}
			});

			$('body').on('keydown', function(e) {
				switch(e.which) {
					case 27: // esc
						$('.listen-player-selector').removeClass('active');
						$('.context-menu').removeClass('active');
						break;
					case 32: // пробел
						radio !== undefined ? $('.station.active').play() : showMessage('noselect');
						break;
					case (e.which>=49 && e.which<=52 ? e.which : false): // 1, 2, 3, 4 (не numpad!)
						$(`.station:eq(${e.which-49})`).play();
						break;
					case (e.which>=97 && e.which<=100 ? e.which : false): // 1, 2, 3, 4 (numpad)
						$(`.station:eq(${e.which-97})`).play();
						break;
					case 77: // m
						if(soundManager.muted) {
							soundManager.unmute();
							$('.volume-click').animateSprite('frame', smVolume/10);
							showMessage('unmute');
						} else {
							soundManager.mute();
							$('.volume-click').animateSprite('frame', 0);
							showMessage('mute');
						}
						break;
					case 82: { // r
						if(playStatus === 'playing' || playStatus === 'connecting') {
							$('.station.active').restart();
						} else if(!$('.station').hasClass('active')) {
							showMessage('noselect');
						} else {
							showMessage('notplaying');
						}
						break;
					}
				}
			});
		</script>
	</body>
</html>
